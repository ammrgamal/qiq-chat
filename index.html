<script>
  const form = document.getElementById('qiq-form');
  const input = document.getElementById('qiq-input');
  const windowEl = document.getElementById('qiq-window');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const userMsg = input.value.trim();
    if (!userMsg) return;
    windowEl.innerHTML += `<div><b>You:</b> ${userMsg}</div>`;
    input.value = '';

    try {
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: [{ role: 'user', content: userMsg }] })
      });

      const data = await res.json();
      if (!res.ok) {
        windowEl.innerHTML += `<div style="color:#b00020"><b>Error:</b> ${data.error || 'Unknown error'}</div>`;
      } else {
        const reply = data.choices?.[0]?.message?.content || 'No reply';
        windowEl.innerHTML += `<div><b>AI:</b> ${reply}</div>`;
      }
    } catch (err) {
      windowEl.innerHTML += `<div style="color:#b00020"><b>Error:</b> ${err.message}</div>`;
    }

    windowEl.scrollTop = windowEl.scrollHeight;
  });
</script>
