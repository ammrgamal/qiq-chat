<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø·Ù„Ø¨ Ø¹Ø±Ø¶ Ø³Ø¹Ø± | QuickITQuote</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <!-- SheetJS for Excel import/export functionality -->
  <script>
    // Simple Excel-compatible CSV with .xls extension as fallback if SheetJS fails
    window.XLSX_FALLBACK = true;
  </script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" onerror="console.warn('XLSX library failed to load, using fallback')"></script>
  <style>
    :root{ --border:#e5e7eb; --muted:#6b7280; --accent:#2563eb; --bg:#f8fafc; --ok:#059669; }
    body{ font-family:Inter,system-ui,Segoe UI,Arial; background:#fff; color:#111; margin:0 }
    .container{ max-width:1000px; margin:20px auto; padding:16px }
    .card{ border:1px solid var(--border); border-radius:16px; padding:16px; background:#fff; margin-bottom:14px }
    .row{ display:grid; gap:10px; grid-template-columns:repeat(12,1fr) }
    .col-12{ grid-column:span 12 } .col-6{ grid-column:span 6 } .col-4{ grid-column:span 4 } .col-3{ grid-column:span 3 }
    label{ font-size:13px; color:#374151; display:block; margin-bottom:6px }
    input,select,textarea{ width:100%; border:1px solid var(--border); border-radius:10px; padding:10px; font-size:14px; background:#fff }
    textarea{ min-height:90px; resize:vertical }
    .muted{ color:var(--muted); font-size:12px }
    .flex{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .right{ margin-inline-start:auto }
    .btn{ border:0; border-radius:10px; padding:10px 14px; background:#374151; color:#fff; cursor:pointer }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .btn-primary{ background:var(--accent) }
    .btn-ok{ background:var(--ok) }
    .table-wrap{ overflow:auto }
    table{ width:100%; border-collapse:collapse; table-layout:fixed }
    th,td{ border-bottom:1px solid var(--border); padding:10px; vertical-align:top; text-align:right }
    tfoot td{ font-weight:700 }
    .totals{ display:grid; gap:8px; grid-template-columns:1fr auto; align-items:center; margin-top:10px }
    .quote-head{ display:flex; align-items:center; gap:14px; margin:8px 0 14px }
    .logo{ width:120px; height:56px; object-fit:contain; border:1px dashed var(--border); border-radius:8px; background:#fff }
    .print-only{ display:none }
    @media print{
      .no-print{ display:none !important }
      .print-only{ display:block }
      body{ background:#fff }
      .card{ break-inside:avoid }
    }
    .notice{ background:#f0f9ff; border:1px solid #dbeafe; color:#0c4a6e; padding:8px 10px; border-radius:10px; font-size:13px }
    .checkbox{ display:flex; align-items:center; gap:8px }
    .btn-danger{ background:#dc2626 !important; }
    .btn-danger:hover{ background:#b91c1c !important; }
    .loading-spinner{ display:inline-block; width:16px; height:16px; border:2px solid #fff; border-top:2px solid transparent; border-radius:50%; animation:spin 1s linear infinite; margin-right:8px; }
    @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }
    .sticky-header thead th{ position:sticky; top:0; background:#f5f7fa; z-index:10; }
    .search-container{ margin:10px 0; }
    .search-input{ width:300px; padding:8px; border:1px solid var(--border); border-radius:8px; }
    .preview-overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:9999; }
    .preview-overlay img{ max-width:90vw; max-height:90vh; border-radius:8px; }
    .preview-close{ position:absolute; top:20px; right:20px; background:#fff; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; font-size:20px; }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header / Logo + meta -->
    <div class="card">
      <div class="quote-head">
        <img id="qo-logo" class="logo" alt="Logo" />
        <div>
          <div style="font-size:18px; font-weight:700">Ø¹Ø±Ø¶ Ø³Ø¹Ø± / Quotation</div>
          <div class="muted">Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶: <span id="qo-number"></span> â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="qo-date"></span></div>
          <div class="muted">Ø§Ù„Ø¹Ù…Ù„Ø©: <span id="qo-currency-view"></span> â€¢ Ø´Ø±ÙˆØ· Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 50% Ù…Ù‚Ø¯Ù…Ø© + 50% Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
        </div>
        <div class="right no-print flex">
          <button id="btn-print" class="btn">Ø·Ø¨Ø§Ø¹Ø© / PDF</button>
          <button id="btn-save" class="btn btn-ok">Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©</button>
        </div>
      </div>
      <div class="notice no-print">Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø¹Ù†Ø§ØµØ± â€œStagedâ€ Ù…Ù† Ø§Ù„Ø´Ø§ØªØŒ Ø§Ù„ØµÙØ­Ø© Ù‡ØªÙ‚Ø±Ø£Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† <code>localStorage</code> (Ø§Ù„Ù…ÙØªØ§Ø­ <code>qiq_staged_items</code>).</div>
    </div>

    <!-- Client & Project -->
    <div class="card">
      <div class="row">
        <div class="col-6">
          <label>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©/Ø§Ù„Ø¬Ù‡Ø©)</label>
          <input id="client-name" placeholder="Ù…Ø«Ø§Ù„: ACME Systems" />
        </div>
        <div class="col-3">
          <label>Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
          <input id="client-contact" placeholder="Ø§Ù„Ø§Ø³Ù…" />
        </div>
        <div class="col-3">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input id="client-email" type="email" placeholder="name@example.com" />
          <div class="email-hint">Please use your business email for faster response.</div>
        </div>
        <div class="col-3">
          <label>Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input id="client-phone" placeholder="+20..." />
        </div>
        <div class="col-3">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
          <input id="project-name" placeholder="Project X" />
        </div>
        <div class="col-3">
          <label>ØµØ§Ø­Ø¨ / Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø¥Ù† ÙˆØ¬Ø¯)</label>
          <input id="project-owner" placeholder="Owner name" />
        </div>
        <div class="col-3">
          <label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… (Ø¥Ù† ÙˆØ¬Ø¯)</label>
          <input id="main-contractor" placeholder="General Contractor" />
        </div>
        <div class="col-3">
          <label>Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ†ÙÙŠØ°</label>
          <input id="site-location" placeholder="City, Country" />
        </div>
        <div class="col-3">
          <label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>
          <select id="currency">
            <option value="USD">$ USD</option>
            <option value="EUR">â‚¬ EUR</option>
            <option value="EGP">Ø¬Ù†ÙŠÙ‡ EGP</option>
            <option value="AED">Ø¯.Ø¥ AED</option>
            <option value="SAR">Ø±.Ø³ SAR</option>
          </select>
        </div>
        <div class="col-3">
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¶</label>
          <input id="quote-date" type="date" />
        </div>
        <div class="col-6 checkbox">
          <input id="need-assist" type="checkbox" />
          <label for="need-assist" style="margin:0">Ø£Ø­ØªØ§Ø¬ Ù…ÙƒØ§Ù„Ù…Ø©/Ù…Ø³Ø§Ø¹Ø¯Ø© Ù‚Ø¨Ù„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø±Ø¶</label>
        </div>
      </div>
    </div>

    <!-- Items -->
    <div class="card">
      <div class="flex">
        <div style="font-weight:700">Ø¨Ù†ÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</div>
        <div class="right no-print flex">
          <button id="btn-clear-all" class="btn btn-danger">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
          <button id="btn-import-excel" class="btn btn-primary">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel</button>
          <button id="btn-export-csv" class="btn">ØªØµØ¯ÙŠØ± CSV</button>
          <button id="btn-export-excel" class="btn">ØªØµØ¯ÙŠØ± XLSX</button>
          <button id="btn-add-row" class="btn">Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ ÙŠØ¯ÙˆÙŠ</button>
          <button id="btn-load-staged" class="btn">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù…Ù† Ø§Ù„Ø´Ø§Øª</button>
        </div>
      </div>
      
      <!-- User Guidance Note -->
      <div class="quote-guidance no-print">
        Add products, edit quantities, then request your quote.
      </div>
      
      <!-- Search/Filter -->
      <div class="search-container no-print">
        <input id="search-input" class="search-input" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¨Ù†ÙˆØ¯ (Ø§Ù„ÙˆØµÙ Ø£Ùˆ PN/SKU)..." />
      </div>
      
      <!-- Empty State -->
      <div id="empty-state" class="empty-state" style="display:none">
        <div class="empty-state-content">
          <div class="empty-icon">ğŸ“¦</div>
          <div class="empty-message">Add products to start your quote.</div>
        </div>
      </div>
      
      <div class="table-wrap">
        <table id="items-table" class="compact-quote-table sticky-header" aria-label="Quote items">
          <thead>
            <tr>

              <th style="width:86%">Description / PN / SKU</th>
              <th style="width:4%">Price</th>
              <th style="width:3%">QTY</th>
              <th style="width:4%">Total</th>
              <th class="no-print" style="width:3%">Action</th>
main
            </tr>
          </thead>
          <tbody id="items-body"></tbody>
          <tfoot>
            <tr>
              <td colspan="3" style="text-align:left">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ (Subtotal):</td>
              <td id="subtotal-cell" class="numeric">-</td>
              <td class="no-print"></td>
            </tr>
            <tr>
              <td colspan="3" class="checkbox" style="text-align:left">
                <input id="include-install" type="checkbox" />
                <label for="include-install" style="margin:0">Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ ØªØ±ÙƒÙŠØ¨ Ø§Ø®ØªÙŠØ§Ø±ÙŠ (5% Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ)</label>
              </td>
              <td id="install-cell" class="numeric">0</td>
              <td class="no-print"></td>
            </tr>
            <tr>
              <td colspan="3" style="text-align:left">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ (Grand Total):</td>
              <td id="grand-cell" class="numeric"><strong>-</strong></td>
              <td class="no-print"></td>
            </tr>
          </tfoot>
        </table>
      </div>
      
      <!-- Hidden file input for Excel import -->
      <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display:none" />
    </div>

    <!-- Payments & Terms -->
    <div class="card">
      <div class="row">
        <div class="col-6">
          <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
          <textarea id="payment-terms">50% Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ØŒ 50% Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…. Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ±ÙƒÙŠØ¨Ø§Øª â€” Ø¥Ù† Ø·ÙÙ„Ø¨Øª â€” ÙŠØªÙ… Ø³Ø¯Ø§Ø¯Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„ ÙˆÙÙ‚ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§.</textarea>
          <div class="muted">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø© Ø´Ø±ÙƒØªÙƒ.</div>
        </div>
        <div class="col-6">
          <label>Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… (Terms & Conditions)</label>
          <textarea id="terms">Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø§ ØªØ´Ù…Ù„ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø£Ùˆ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ© Ø¥Ù† ÙˆØ¬Ø¯Øª. ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ 14 ÙŠÙˆÙ…Ù‹Ø§ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ù…Ø§ Ù„Ù… ÙŠÙØ°ÙƒØ± Ø®Ù„Ø§Ù Ø°Ù„Ùƒ. Ù‚Ø¯ ØªØ®ØªÙ„Ù Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙØ±. Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ù‚Ø¯ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯.</textarea>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="card no-print">
      <div class="flex">
        <div class="muted">Ø³ÙŠØªÙ‘Ù… ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹/Ø§Ù„Ù…Ø­ÙÙˆØ¸ PDF.</div>
        <div class="right flex">
          <button id="btn-generate" class="btn btn-primary">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª</button>
          <button id="btn-request-special" class="btn">Ø·Ù„Ø¨ Ø³Ø¹Ø± Ù…ÙØ®ØµÙ‘Øµ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚</button>
          <button id="btn-submit" class="btn btn-ok">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </div>
      
      <!-- Proceed to Request Quote CTA -->
      <div id="proceed-cta" class="proceed-cta" style="display:none">
        <button id="btn-proceed-quote" class="btn-proceed">
          <span class="proceed-icon">ğŸ“‹</span>
          <span class="proceed-text">Proceed to Request Quote</span>
        </button>
      </div>
    </div>

    <!-- Hidden payload preview (for debug) -->
    <pre id="payload-preview" class="card print-only" style="white-space:pre-wrap;word-wrap:break-word"></pre>

    <!-- Image Preview Overlay -->
    <div id="image-preview-overlay" class="preview-overlay">
      <button class="preview-close" onclick="closeImagePreview()">Ã—</button>
      <img id="preview-image" src="" alt="Preview" />
    </div>

  </div>
 copilot/fix-4469cf6e-7277-40cb-916f-dd572d8ca406
  <script src="js/toast.js"></script>
  <script src="js/quote.js"></script>
</body>
</html>
