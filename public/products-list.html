<!doctype html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<base href="/" />
	<title>ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
			<link rel="stylesheet" href="/css/styles.css">
		<link rel="stylesheet" href="/css/enhanced-catalog.css">
		<link rel="stylesheet" href="/css/professional-design.css">
		<style>
			:root{
				--brand-primary:#1e3a8a; /* navy */
				--brand-accent:#0ea5e9;  /* sky */
				--brand-success:#059669; /* green */
				--brand-danger:#dc2626;  /* red */
				--brand-muted:#6b7280;   /* gray */
				--brand-bg:#f8fafc;
				--card-bg:#ffffff;
				--border:#e5e7eb;
			}
			body{font-family:Inter,system-ui,Segoe UI,Arial;margin:0;background:var(--brand-bg);color:#111}
			.container{max-width:1200px;margin:16px auto;padding:12px}
			.topbar{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border)}
			.topbar-inner{max-width:1200px;margin:0 auto;padding:10px 12px;display:flex;gap:12px;align-items:center}
			.brand{display:flex;gap:10px;align-items:center;color:var(--brand-primary);font-weight:700}
			.brand a{color:var(--brand-primary);text-decoration:none}
			.brand .dot{width:8px;height:8px;border-radius:50%;background:var(--brand-accent)}
			.header{display:flex;align-items:center;gap:12px;margin:12px 0}
			.header a{color:var(--brand-primary);text-decoration:none}
			.toolbar{display:flex;gap:8px;align-items:center;margin:10px 0}
			.toolbar input{flex:1;min-width:280px;padding:10px;border:1px solid var(--border);border-radius:10px}
			.view-toggle{margin-inline-start:auto;display:flex;gap:6px}
			.view-toggle button{padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:#fff;cursor:pointer}
			.view-toggle .active{background:var(--brand-primary);color:#fff;border-color:var(--brand-primary)}
			.layout{display:grid;grid-template-columns:260px 1fr;gap:16px}
			.sidebar{
				border:1px solid var(--border);
				border-radius:12px;
				padding:16px;
				height:fit-content;
				background:#fff;
				position:sticky;
				top:80px;
				max-height:calc(100vh - 100px);
				overflow-y:auto;
				box-shadow:0 2px 8px rgba(0,0,0,0.05);
			}
			.facet{margin-bottom:12px}
			.facet h3{font-size:14px;margin:6px 0}
			.facet ul{list-style:none;padding:0;margin:0;max-height:260px;overflow:auto}
			.facet li{display:flex;align-items:center;gap:8px;padding:4px 0}
			.range{display:flex;gap:8px}
			.range input{width:100%;padding:6px;border:1px solid var(--border);border-radius:8px}
			.results{display:block}
			.results.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
			.card{border:1px solid var(--border);border-radius:12px;padding:16px;display:flex;gap:12px;align-items:flex-start;background:var(--card-bg);transition:all 0.2s ease;position:relative}
			.card:hover{border-color:var(--brand-primary);box-shadow:0 4px 12px rgba(30, 58, 138, 0.1);transform:translateY(-2px)}
			.card.grid{flex-direction:column;box-shadow:0 4px 12px rgba(0,0,0,0.06)}
			.card.grid:hover{box-shadow:0 8px 20px rgba(30, 58, 138, 0.15)}
			.card img{width:60px;height:60px;border-radius:8px;object-fit:cover;background:#f3f4f6}
			.card.grid img{width:100%;height:150px}
			.card .name{font-weight:600;margin-bottom:8px;color:#111;line-height:1.3}
			.card .description{color:var(--brand-muted);font-size:14px;margin-bottom:8px;line-height:1.4}
			.card-content{flex:1;min-width:0}
			.card-actions{margin-inline-start:auto;display:flex;gap:8px;flex-shrink:0}
			.card.grid .card-actions{margin-inline-start:0;justify-content:center;margin-top:12px}
			.chips{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
			.chip{background:#f3f4f6;border-radius:999px;padding:2px 8px;font-size:12px;color:#374151}
			.price{background:#eef2ff;color:#3730a3}
			.actions{margin-inline-start:auto;display:flex;gap:6px;flex-wrap:wrap}
			.btn{border:0;border-radius:10px;padding:8px 12px;background:var(--brand-primary);color:#fff;cursor:pointer;font-weight:500;transition:all 0.2s ease;box-shadow:0 2px 4px rgba(30, 58, 138, 0.2)}
			.btn:hover{background:#1e40af;transform:translateY(-1px);box-shadow:0 4px 8px rgba(30, 58, 138, 0.3)}
			.btn.secondary{background:var(--brand-muted);color:#fff;box-shadow:0 2px 4px rgba(107, 114, 128, 0.2)}
			.btn.secondary:hover{background:#4b5563;transform:translateY(-1px)}
			.btn.ghost{background:#fff;color:var(--brand-primary);border:2px solid var(--brand-primary);box-shadow:0 2px 4px rgba(30, 58, 138, 0.1)}
			.btn.ghost:hover{background:var(--brand-primary);color:#fff;transform:translateY(-1px);box-shadow:0 4px 8px rgba(30, 58, 138, 0.2)}
			.btn.success{background:var(--brand-success);color:#fff;box-shadow:0 2px 4px rgba(5, 150, 105, 0.2)}
			.btn.success:hover{background:#047857;transform:translateY(-1px)}
			.btn.danger{background:var(--brand-danger);color:#fff;box-shadow:0 2px 4px rgba(220, 38, 38, 0.2)}
			.btn.danger:hover{background:#b91c1c;transform:translateY(-1px)}
			.muted{color:#6b7280}
			.pagination{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0}
			.pagination button{padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:#fff;cursor:pointer}
			.pagination .active{background:var(--brand-primary);color:#fff;border-color:var(--brand-primary)}
			.quick-btn{background:#f3f4f6;border:1px solid var(--border);border-radius:12px;padding:8px 12px;cursor:pointer;transition:all 0.2s;font-size:14px}
			.quick-btn:hover{background:#e5e7eb;transform:translateY(-1px)}
			.quick-btn.active{background:var(--brand-primary);color:#fff;border-color:var(--brand-primary)}
			@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
			.quote-section{border:1px solid var(--border);border-radius:12px;padding:16px;background:#fafafa}
			.motivational-message{font-weight:500;border-left:4px solid var(--brand-success)}
			/* List line style (true lines) */
			#results.list-lines{display:block}
			#results.list-lines .card{display:grid;grid-template-columns:56px 1fr auto;align-items:center;gap:10px;padding:8px 10px;border-bottom:1px solid var(--border);border-radius:0;box-shadow:none}
			#results.list-lines .card img{width:44px;height:44px}
			#results.list-lines .card .name{line-height:1.25}
			#results.list-lines .card .chips{margin:4px 0}
			#results.list-lines .card .actions{margin-inline-start:0}
			/* Ghost button contrast in dark mode will be handled by ui-enhancements */
			/* Simple skeleton */
			.skeleton{background:linear-gradient(90deg,#f3f4f6 25%,#e5e7eb 50%,#f3f4f6 75%);background-size:200% 100%;animation:shimmer 1.2s infinite}
			@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
		</style>
</head>
<body>
	<div class="topbar">
		<div class="topbar-inner">
			<div class="brand">
				<span class="dot"></span>
				<a href="https://ai.quickitquote.com/" target="*_blank" rel="noopener">QuickITQuote</a>
				<span class="muted" style="font-weight:500">Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬</span>
			</div>
						<div class="view-toggle">
				<a class="btn ghost" href="/index.html" title="AI Agent">Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</a>
				<button id="viewList" class="active" title="Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø³Ø·ÙˆØ±">Ø³Ø·ÙˆØ±</button>
				<button id="viewGrid" title="Ø¹Ø±Ø¶ Ø´Ø¨ÙƒÙŠ">Ø´Ø¨ÙƒØ©</button>
							<button id="viewTable" title="Ø¹Ø±Ø¶ ÙƒØ¬Ø¯ÙˆÙ„">Ø¬Ø¯ÙˆÙ„</button>
				<button id="themeToggle" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ" style="margin-inline-start:8px">ğŸŒ™</button>
				<button id="langToggleCatalog" title="Ø§Ù„Ù„ØºØ©">AR/EN</button>
			</div>
		</div>
	</div>
		<div class="container">
		<div class="header">
			<h1 style="margin:0">ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
			<div class="muted" id="status"></div>
			<div style="margin-inline-start:auto; display: flex; gap: 8px; align-items: center;">
				<select id="qiq-currency-select" class="btn ghost" style="padding:6px 10px">
					<option value="USD">USD $</option>
					<option value="EUR">EUR â‚¬</option>
					<option value="SAR">SAR Ø±.Ø³</option>
					<option value="EGP">EGP Ø¬.Ù…</option>
				</select>
				<button id="favorites-btn" class="btn ghost" style="position: relative;">
					â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©
					<span class="favorites-badge" style="position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: none;">0</span>
				</button>
				<button id="comparison-btn" class="btn ghost" style="position: relative;">
					âš–ï¸ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
					<span class="comparison-badge" style="position: absolute; top: -8px; right: -8px; background: #3b82f6; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: none;">0</span>
				</button>
				<button class="btn secondary" data-open-quote-wizard>Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</button>
			</div>
		</div>
		<div class="toolbar">
			<input id="q" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / PN / SKU" />
			<button id="searchBtn" class="btn">Ø¨Ø­Ø«</button>
			<button id="clearBtn" class="btn secondary">Ù…Ø³Ø­</button>
      <input id="qiq-ref-input" type="text" placeholder="BOQ Ref" style="margin-inline-start:auto;min-width:180px;padding:8px;border:1px solid var(--border);border-radius:8px" />
      <button id="qiq-ref-load" class="btn secondary" type="button">ØªØ­Ù…ÙŠÙ„</button>
      <button id="qiq-ref-save" class="btn" type="button">Ø­ÙØ¸ ÙƒÙ…Ø±Ø¬Ø¹</button>
		</div>

		<!-- Connectivity status (inline helper) -->
		<div id="qiq-connectivity" class="muted" style="margin: 6px 0 12px; font-size: 12px"></div>
		
		<!-- Chat-like Quick Action Buttons (refined) -->
		<div class="quick-actions" style="margin: 16px 0; display: flex; gap: 8px; flex-wrap: wrap;">
			<button class="quick-btn" data-query="SFP module">ğŸ”Œ ÙˆØ­Ø¯Ø§Øª SFP</button>
			<button class="quick-btn" data-query="PoE switch">ğŸ”§ Ø³ÙˆÙŠØªØ´Ø§Øª PoE</button>
			<button class="quick-btn" data-query="Cat6 cable">ğŸ§µ ÙƒØ§Ø¨Ù„Ø§Øª Cat6</button>
			<button class="quick-btn" data-query="CCTV camera">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
			<button class="quick-btn" data-query="UPS">âš¡ UPS ÙˆØ§Ù„Ø·Ø§Ù‚Ø©</button>
			<button class="quick-btn" data-query="WiFi access point">ğŸ“¡ Ù†Ù‚Ø§Ø· ÙˆØµÙˆÙ„ Wiâ€‘Fi</button>
			<button id="openV0UI" class="quick-btn" title="ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ø¬Ù‡Ø© V0">âœ¨ ÙˆØ§Ø¬Ù‡Ø© V0</button>
		</div>
		
		<!-- Motivational Messages -->
		<div id="motivational-message" class="motivational-message" style="
			margin: 12px 0; padding: 12px 16px; background: linear-gradient(135deg, var(--brand-success) 0%, #037957 100%);
			color: white; border-radius: 12px; display: none; animation: slideIn 0.5s ease-out;
		">
			<span id="message-text">ğŸ¯ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù…Ø´Ø±ÙˆØ¹Ùƒ ÙˆØ§Ø¨Ù†ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø³Ø±Ø¹Ø©</span>
		</div>
			<div class="layout">
				<aside class="sidebar">
					<div class="facet" id="facet-brands">
						<h3>Ø§Ù„Ø´Ø±ÙƒØ©</h3>
						<ul></ul>
					</div>
					<div class="facet" id="facet-categories">
						<h3>Ø§Ù„ÙØ¦Ø©</h3>
						<ul></ul>
					</div>
					<div class="facet" id="facet-quick-price">
						<h3>Ù†Ø·Ø§Ù‚Ø§Øª Ø³Ø¹Ø± Ø³Ø±ÙŠØ¹Ø©</h3>
						<div class="range" style="flex-direction:column;gap:6px">
							<button class="quick-btn" data-price-min="0" data-price-max="100">Ø­ØªÙ‰ 100$</button>
							<button class="quick-btn" data-price-min="100" data-price-max="500">100â€“500$</button>
							<button class="quick-btn" data-price-min="500" data-price-max="2000">500â€“2000$</button>
							<button class="quick-btn" data-price-min="2000" data-price-max="">Ø£ÙƒØ«Ø± Ù…Ù† 2000$</button>
						</div>
					</div>
					<div class="facet">
						<h3>Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³Ø¹Ø±</h3>
						<div class="range">
							<input id="priceMin" type="number" placeholder="Ø§Ù„Ø£Ø¯Ù†Ù‰" />
							<input id="priceMax" type="number" placeholder="Ø§Ù„Ø£Ù‚ØµÙ‰" />
						</div>
						<div style="margin-top:8px">
							<button id="applyPrice" class="btn secondary" style="padding:6px 10px">ØªØ·Ø¨ÙŠÙ‚</button>
						</div>
					</div>
					<div class="facet" id="facet-extras">
						<h3>Ø®ØµØ§Ø¦Øµ Ø£Ø®Ø±Ù‰</h3>
						<ul>
							<li><label><input type="checkbox" id="hasImage"> Ø¨Ù‡ ØµÙˆØ±Ø©</label></li>
							<li><label><input type="checkbox" id="inStock"> Ù…ØªÙˆÙØ± (Ø¥Ù† ÙˆØ¬Ø¯)</label></li>
						</ul>
					</div>
				</aside>
								<main>
										<div class="results" id="results"></div>
										<div class="table-container" id="resultsTableWrap" style="display:none;overflow:auto;border:1px solid var(--border);border-radius:12px;background:#fff">
											<table id="resultsTable" style="width:100%;border-collapse:collapse">
												<thead style="background:#f8fafc;position:sticky;top:0">
													<tr>
														<th style="text-align:right;padding:8px 10px;border-bottom:1px solid var(--border)">Ø§Ù„ØµÙˆØ±Ø©</th>
														<th style="text-align:right;padding:8px 10px;border-bottom:1px solid var(--border)">Ø§Ù„ÙˆØµÙ</th>
														<th style="text-align:right;padding:8px 10px;border-bottom:1px solid var(--border)">PN</th>
														<th style="text-align:right;padding:8px 10px;border-bottom:1px solid var(--border)">Ø§Ù„Ø´Ø±ÙƒØ©</th>
														<th style="text-align:right;padding:8px 10px;border-bottom:1px solid var(--border)">Ø§Ù„Ø³Ø¹Ø±</th>
														<th style="text-align:center;padding:8px 10px;border-bottom:1px solid var(--border)">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
													</tr>
												</thead>
												<tbody id="resultsTbody"></tbody>
											</table>
										</div>
					<div class="pagination" id="pagination"></div>
				</main>
			</div>
	</div>
		<script src="/js/performance.js"></script>
		<script src="/js/currency.js"></script>
		<script src="/js/toast.js"></script>
		<script src="/js/security.js"></script>
		<script src="/js/user-features.js"></script>
		<script src="/js/products-ui-enhanced.js"></script>
		<script src="/js/product-data-enhancer.js"></script>
		<script src="/js/product-image-handler.js"></script>
		<script src="/js/catalog-enhancements.js"></script>
		<script src="/js/enhanced-ui-components.js"></script>
		<script src="/js/experimental-banner.js"></script>
		<script src="/js/ui-enhancements.js"></script>
		<script src="/js/analytics.js"></script>
		<script src="/js/quote-actions.js"></script>
		<script src="/js/products-search-enhanced.js"></script>
		<script src="/js/quote-wizard.js"></script>
		<script src="/js/quote-wizard-debug.js"></script>
		<script src="/js/quote-badge.js"></script>
	<script>
	// Theme toggle hook
	document.addEventListener('DOMContentLoaded', function(){
	  // Ensure app-wide default currency reflects USD
	  try { window.QiqSession = window.QiqSession || {}; if (!window.QiqSession.currency) window.QiqSession.currency = 'USD'; } catch {}
	  const btn = document.getElementById('themeToggle');
	  if (!btn) return;
	  const applyIcon = ()=> btn.textContent = (window.QiqTheme?.currentTheme === 'dark') ? 'â˜€ï¸' : 'ğŸŒ™';
	  applyIcon();
	  btn.addEventListener('click', ()=>{ try{ const t = window.QiqTheme?.toggle(); btn.textContent = (t==='dark')?'â˜€ï¸':'ğŸŒ™'; }catch{} });
	  // Language toggle
	  const langBtn = document.getElementById('langToggleCatalog');
	  langBtn?.addEventListener('click', ()=>{ try{ window.QiqI18n?.toggle?.(); }catch{} });

	  // Currency select wiring
	  const curSel = document.getElementById('qiq-currency-select');
	  if (curSel && window.QiqCurrency) {
	    // Set current value
	    try { curSel.value = window.QiqCurrency.currencyCode || 'USD'; } catch {}
	    curSel.addEventListener('change', async function(){
	      try {
	        const code = this.value || 'USD';
	        await window.QiqCurrency.ensureRates();
	        window.QiqCurrency.setCurrency(code);
	        // notify UI to refresh price labels
	        window.dispatchEvent(new CustomEvent('qiq-refresh-prices'));
	      } catch {}
	    });
	  }
	});
	</script>
	<script>
	// V0 UI launcher
	(function(){
	  document.addEventListener('DOMContentLoaded', function(){
	    const btn = document.getElementById('openV0UI');
	    if (!btn) return;
	    btn.addEventListener('click', async function(){
	      try{
	        const prompt = 'Build a split layout with chat (left) and quote summary (right). Arabic labels, dark-mode-friendly. Include a form with a textarea#v0ChatInput and button#v0ChatSend. Render results in a div#v0ChatArea. Include a panel with buttons having data-add attributes to add items.';
	        const context = { theme: (window.QiqTheme?.currentTheme||'light'), catalog: true };
					let html = '';
					try {
						const r = await fetch('/api/v0/ui', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ prompt, context }) });
						const j = await r.json();
						html = j?.html || '';
						if (!html) throw new Error('No HTML from /api/v0/ui');
					} catch {
						// Fallback to /api/v0/design if available
						try {
							const r2 = await fetch('/api/v0/design', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ prompt, type: 'component' }) });
							const j2 = await r2.json();
							html = j2?.component?.html || j2?.component || '<div style="padding:16px;color:#6b7280">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ù…ÙˆÙ„Ø¯Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØ§ØªÙŠØ­ V0.</div>';
						} catch {
							html = '<div style="padding:16px;color:#6b7280">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ù…ÙˆÙ„Ø¯Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØ§ØªÙŠØ­ V0.</div>';
						}
					}
	        window.QiqModal?.open('#', { title:'ÙˆØ§Ø¬Ù‡Ø© V0', html, size:'lg' });
	        // After modal loads, lightly enhance the generated UI without conflicting with existing code
	        setTimeout(()=>{
	          try{
	            const frame = window.QiqModal?.getFrame?.();
	            const doc = frame?.contentDocument; if (!doc) return;
	            // Wire chat send to /api/chat
	            const input = doc.getElementById('v0ChatInput');
	            const btnSend = doc.getElementById('v0ChatSend');
	            const area = doc.getElementById('v0ChatArea') || doc.body;
	            async function sendMsg(){
	              try{
	                const msg = String(input?.value||'').trim(); if (!msg) return;
	                const pre = doc.createElement('div'); pre.style.whiteSpace='pre-wrap'; pre.style.margin='6px 0'; pre.textContent = 'You: ' + msg; area.appendChild(pre);
	                input.value = '';
	                const resp = await fetch('/api/chat', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ messages: [{ role:'user', content: msg }] }) });
	                const j = await resp.json();
	                const ans = doc.createElement('div'); ans.style.whiteSpace='pre-wrap'; ans.style.margin='6px 0'; ans.textContent = (j?.reply||'ØªÙ….'); area.appendChild(ans);
	                // Optional hits rendering
	                if (Array.isArray(j?.hits) && j.hits.length){
	                  const wrap = doc.createElement('div'); wrap.style.margin='8px 0';
	                  j.hits.slice(0,6).forEach(h=>{
	                    const card = doc.createElement('div'); card.style.border='1px solid #e5e7eb'; card.style.borderRadius='8px'; card.style.padding='8px'; card.style.margin='6px 0';
	                    card.innerHTML = `<div style="font-weight:600">${(h.name||'').replace(/</g,'&lt;')}</div>
	                      <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
	                        <img src="${(h.image||'').replace(/"/g,'&quot;')}" alt="" style="width:56px;height:56px;object-fit:contain;border:1px solid #eee;border-radius:6px" onerror="this.style.display='none'"/>
	                        <div style="font-size:12px;color:#374151">${(h.sku||'')}
	                          <div><button class="btn" data-add='${JSON.stringify({name:h.name, price:h.price, pn:h.sku, image:h.image||'', link:h.link||'', source:'V0'}).replace(/'/g,'&#39;')}'>Add</button></div>
	                        </div>
	                      </div>`;
	                    wrap.appendChild(card);
	                  });
	                  area.appendChild(wrap);
	                }
	              }catch{}
	            }
	            btnSend?.addEventListener('click', (e)=>{ e.preventDefault(); sendMsg(); });
	            input?.addEventListener('keydown', (e)=>{ if (e.key==='Enter' && (e.ctrlKey||e.metaKey)) { e.preventDefault(); sendMsg(); } });
	            // Wire add buttons to AddToQuote via parent bridge already present in modal.js
	            doc.addEventListener('click', function(ev){
	              const t = ev.target.closest('[data-add]'); if (!t) return;
	              try { const payload = JSON.parse(t.getAttribute('data-add')); doc.defaultView.AddToQuote?.(payload); } catch {}
	            });
	          }catch{}
	        }, 50);
	      }catch(e){ window.QiqModal?.open('#', { title:'ÙˆØ§Ø¬Ù‡Ø© V0', html: '<div style="padding:16px;color:#6b7280">ØªØ¹Ø°Ø± ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¢Ù†.</div>', size: 'sm' }); }
	    });
	  });
	})();
	</script>
	<script>
	// Reference save/load
	(function(){
		document.addEventListener('DOMContentLoaded', function(){
			const inp = document.getElementById('qiq-ref-input');
			const bL = document.getElementById('qiq-ref-load');
			const bS = document.getElementById('qiq-ref-save');
			try{ const cur = window.QiqBOQ?.getCurrentRef?.(); if (cur && inp) inp.value = cur; }catch{}
			bL?.addEventListener('click', ()=>{
				const ref = (inp?.value||'').trim(); if (!ref) return;
				const ok = window.QiqBOQ?.loadRef?.(ref);
				if (ok) { window.QiqToast?.success?.('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ù„Ù…Ø±Ø¬Ø¹'); } else { window.QiqToast?.error?.('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø±Ø¬Ø¹'); }
			});
			bS?.addEventListener('click', ()=>{
				const ref = window.QiqBOQ?.saveCurrentAsRef?.(inp?.value||'');
				if (ref) { if (inp) inp.value = ref; navigator.clipboard?.writeText(ref).catch(()=>{}); window.QiqToast?.success?.('ØªÙ… Ø§Ù„Ø­ÙØ¸. ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø±Ø¬Ø¹.'); }
			});
		});
	})();
	</script>
	<script>
	// Render a tiny connectivity line from /health for quick diagnostics
	(function(){
	  function chip(name, ok){
		const color = ok ? '#166534' : '#991b1b';
		return `<span style="display:inline-block;margin-inline-end:8px;color:${color}">${name}:${ok?'OK':'â€”'}</span>`;
	  }
	  fetch('/health').then(r=>r.json()).then(h=>{
		const env = h?.env || {};
		const html = [
		  chip('HelloLeads', !!env.hasHelloLeads),
		  chip('Resend', !!env.hasResend),
		  chip('OpenAI', !!env.hasOpenAI),
		  chip('Gemini', !!env.hasGemini),
		  chip('V0', !!env.hasV0),
		  chip('AUTO_APPROVE', !!env.autoApprove)
		].join(' ');
		const el = document.getElementById('qiq-connectivity');
		if (el) el.innerHTML = html;
		// Hide V0 launcher when not configured
		try {
		  const v0Btn = document.getElementById('openV0UI');
		  if (v0Btn) {
			if (!env.hasV0) { v0Btn.style.display = 'none'; }
			else { v0Btn.style.display = ''; }
		  }
		} catch {}
	  }).catch(()=>{});
	})();
	</script>
	<!-- Modal container -->
		<div id="qiq-modal" aria-hidden="true" style="display:none">
				<div class="qiq-modal__backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,.4);"></div>
				<div class="qiq-modal__dialog" tabindex="-1" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(880px,92vw);max-height:86vh;display:flex;flex-direction:column;overflow:hidden;z-index:50">
			<div class="qiq-modal__header" style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border)">
				<div class="qiq-modal__title" style="font-weight:600">Modal</div>
						<button class="qiq-modal__close btn" style="padding:6px 10px;margin-inline-start:8px">Close</button>
				<div style="display:flex;gap:6px;align-items:center">
					<!-- Persistent notice (manual dismiss) -->
					<div id="qiq-modal-notice" style="display:none;background:#f1f5f9;color:#0f172a;padding:4px 8px;border-radius:8px;border:1px solid #cbd5e1">
						<span id="qiq-modal-notice-text"></span>
						<button id="qiq-modal-notice-close" class="btn ghost" style="padding:2px 6px;margin-inline-start:6px">âœ•</button>
					</div>
					<!-- New actions -->
					<button class="qiq-modal__copy btn secondary" id="copyButton" style="padding:6px 10px">Ù†Ø³Ø®</button>
					<button class="qiq-modal__print btn ghost" id="printButton" style="padding:6px 10px">PDF</button>
					<button class="qiq-modal__attach btn" id="attachToQuote" style="padding:6px 10px;background:var(--brand-success)">Ø¥Ø±ÙØ§Ù‚ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±</button>
					<!-- Existing actions -->
				
				</div>
			</div>
					<iframe id="qiq-modal-frame" style="border:0;flex:1;min-height:300px"></iframe>
		</div>
	</div>
		<script src="/js/modal.js"></script>
	<script>
	// Modal helpers: persistent notice, sanitize content, copy, attach to quote
	(function(){
	  const $ = (s, r=document)=> r.querySelector(s);

	  // Show inline notice that doesn't auto-dismiss
	  function showNotice(text, type='info'){
		const box = $('#qiq-modal-notice');
		const msg = $('#qiq-modal-notice-text');
		if (!box||!msg) return;
		const styles = {
		  info:{bg:'#f1f5f9',fg:'#0f172a',bd:'#cbd5e1'},
		  ok:{bg:'#ecfdf5',fg:'#065f46',bd:'#a7f3d0'},
		  warn:{bg:'#fff7ed',fg:'#9a3412',bd:'#fed7aa'},
		  err:{bg:'#fef2f2',fg:'#7f1d1d',bd:'#fecaca'}
		}[type]||{};
		box.style.background = styles.bg || '#f1f5f9';
		box.style.color = styles.fg || '#0f172a';
		box.style.border = '1px solid ' + (styles.bd || '#cbd5e1');
		msg.textContent = text || '';
		box.style.display = text ? 'inline-flex' : 'none';
	  }
	  document.addEventListener('click', (e)=>{ if (e.target?.id==='qiq-modal-notice-close') showNotice(''); });

	  // Provide product context to modal when available
	  window.QiqModal = window.QiqModal || {};
	  window.QiqModal.setCurrentProduct = function(meta={}){
		window.QIQ_CURRENT_PRODUCT = {
		  name: meta.name || meta.title || '',
		  partNumber: meta.partNumber || meta.pn || meta.PN || meta.mpn || meta.sku || '',
		  price: Number(meta.price || 0) || 0,
		  brand: meta.brand || meta.manufacturer || '',
		  image: meta.image || meta.thumbnail || ''
		};
	  };

	  const arabicRe = /[\u0600-\u06FF]/;
	  const latinRe = /[A-Za-z]/;

	  // Ensure English tokens are visually separated to avoid RTL/LTR mix
	  function separateEnglish(line){
		const hasAr = arabicRe.test(line); const hasEn = latinRe.test(line);
		if (hasAr && hasEn){
		  return line.replace(/[A-Za-z0-9_./-]+/g, m => '\u200E'+m+'\u200E'); // wrap with LRM
		}
		return line;
	  }

	  // Clean content: remove Unknown/N.A/ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ/borders/separators; drop empty Pros/Cons
	  function sanitizeText(raw){
		if (!raw) return '';
		let lines = raw.split(/\r?\n/).filter(line=>{
		  const t = line.trim();
		  if (!t) return false;
		  const lower = t.toLowerCase();
		  if (lower.includes('unknown') || lower==='n/a' || lower==='-' || lower==='â€”') return false;
		  if (t.includes('ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ')) return false;
		  if (/^\|[-\s]+\|$/.test(t)) return false;   // ascii borders
		  if (/^[-â”€]{3,}$/.test(t)) return false;       // separators
		  return true;
		});
		lines = lines.map(separateEnglish);
		let cleaned = lines.join('\n');
		cleaned = cleaned.replace(/(^|\n)#+\s*pros.*?(\n#+|\n*$)/gi, (m,p1,p2)=>{ const body=m.replace(/(^|\n)#+\s*pros/gi,''); return /\w/.test(body)?m:(p2||'\n'); });
		cleaned = cleaned.replace(/(^|\n)#+\s*cons.*?(\n#+|\n*$)/gi, (m,p1,p2)=>{ const body=m.replace(/(^|\n)#+\s*cons/gi,''); return /\w/.test(body)?m:(p2||'\n'); });
		// Optionally strip Arabic from technical blocks if mixing causes confusion
		if (!window.QIQ_KEEP_ARABIC_IN_MODAL && arabicRe.test(cleaned)){
		  cleaned = cleaned.replace(/[\u0600-\u06FF]+/g,'').replace(/\n{3,}/g,'\n\n');
		}
		return cleaned.trim();
	  }

	  function getFrameText(){
		try{
		  const doc = $('#qiq-modal-frame')?.contentDocument; if (!doc) return '';
		  const pre = doc.querySelector('pre, code');
		  return (pre?.innerText || doc.body?.innerText || '').trim();
		}catch{ return ''; }
	  }

	  function extractCandidatePN(text){
		const cands = Array.from(text.matchAll(/\b[A-Z0-9][A-Z0-9\-_.]{3,}\b/gi)).map(m=>m[0]);
		const blacklist = new Set(['UNKNOWN','CPU','RAM','PORTS','WARRANTY','POWER','QTY','PN','SKU','PRICE','TOTAL','TABLE','FEATURE']);
		return cands.find(s=>!blacklist.has(s.toUpperCase()) && /\d/.test(s)) || '';
	  }

	  async function onCopy(){
		const cleaned = sanitizeText(getFrameText());
		if (!cleaned) return showNotice('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù†Ø³Ø®.', 'warn');
		try{ await navigator.clipboard.writeText(cleaned); showNotice('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.', 'ok'); }
		catch{ showNotice('ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªØµÙØ­.', 'err'); }
	  }

	  function onAttach(){
		const cleaned = sanitizeText(getFrameText());
		const meta = Object.assign({}, window.QIQ_CURRENT_PRODUCT || {}, { partNumber: (window.QIQ_CURRENT_PRODUCT?.partNumber) || extractCandidatePN(cleaned) });
		const pn = meta.partNumber; if (!pn) return showNotice('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø¬Ø²Ø¡ PN ØµØ§Ù„Ø­.', 'warn');
		try{
		  if (typeof window.addToQuote === 'function'){
			window.addToQuote(pn, 1, meta);
		  } else if (window.QiqQuote?.addItem){
			window.QiqQuote.addItem({ pn, qty:1, name: meta.name||pn, price: meta.price||0, brand: meta.brand||'', image: meta.image||'' });
		  } else {
			const key='qiq_quote_items';
			const items = JSON.parse(localStorage.getItem(key)||'[]');
			items.push({ pn, qty:1, name: meta.name||pn, price: meta.price||0, brand: meta.brand||'', image: meta.image||'' });
			localStorage.setItem(key, JSON.stringify(items));
		  }
		  showNotice('ØªÙ… Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±.', 'ok');
		}catch(e){ console.error('AttachToQuote failed', e); showNotice('ØªØ¹Ø°Ø± Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¢Ù†.', 'err'); }
	  }

	  function cleanupFrame(){
		try{
		  const doc = $('#qiq-modal-frame')?.contentDocument; if (!doc) return;
		  const pre = doc.querySelector('pre, code');
		  if (pre){ const cleaned = sanitizeText(pre.innerText||''); if (cleaned) pre.textContent = cleaned; }
		}catch{}
	  }

	  document.addEventListener('DOMContentLoaded', ()=>{
		$('#copyButton')?.addEventListener('click', onCopy);
			$('#printButton')?.addEventListener('click', ()=>{
				try{
					const f = $('#qiq-modal-frame');
					const w = f?.contentWindow; if (w && typeof w.print === 'function') w.print();
				}catch{}
			});
		$('#attachToQuote')?.addEventListener('click', onAttach);
		$('#qiq-modal-frame')?.addEventListener('load', ()=> setTimeout(cleanupFrame, 60));
	  });
	})();
	</script>
	
	<!-- System Configuration (must be loaded first) -->
	<script src="/js/system-config.js"></script>
	
	<!-- Enhanced System Scripts -->
	<script src="/js/advanced-state-manager.js" defer></script>
	<!-- Enhanced Visitor Tracking Client -->
	<script src="/js/visitor-tracking-client.js" defer></script>
	
	<!-- OpenAI Chat System Integration -->
	<script src="/js/openai-chat-system.js" defer></script>
	
	<!-- Professional Design System -->
	<link rel="stylesheet" href="/css/professional-design.css">
	
	<!-- Enhanced API Integration Scripts -->
	<script src="/js/error-handler-optimizer.js" defer></script>
	<script src="/js/advanced-form-validator.js" defer></script>
	<script src="/js/advanced-analytics.js" defer></script>
	<script src="/js/system-initializer.js" defer></script>
	<script src="/js/fixed-chat-system.js" defer></script>
	<script src="/js/interface-fixes.js" defer></script>
	
	<!-- Enhanced System Integration -->
	<script>
		// Initialize enhanced systems on page load
		document.addEventListener('DOMContentLoaded', function() {
			// Start visitor tracking with enhanced features
			if (typeof initializeVisitorTracking === 'function') {
				initializeVisitorTracking();
			}
			
			// Initialize OpenAI Chat System first
			if (typeof initializeOpenAIChatSystem === 'function') {
				initializeOpenAIChatSystem();
			}
			
			// Initialize interface fixes for all reported issues
			if (typeof initializeInterfaceFixes === 'function') {
				initializeInterfaceFixes();
			}
			
			// Initialize legacy chat system as fallback
			if (typeof initializeFixedChatSystem === 'function') {
				initializeFixedChatSystem();
			}
			
			// Track page view for analytics
			if (typeof trackPageView === 'function') {
				trackPageView('products-list', 'Product Catalog');
			}
		});
	</script>
	
	<!-- Final System Check (must be loaded last) -->
	<script src="/js/system-final-check.js" defer></script>
	
	</body>
	</html>
